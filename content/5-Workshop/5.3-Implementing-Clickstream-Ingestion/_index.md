---
title: "Implementing Clickstream Ingestion"
weight: 53
chapter: false
pre: " <b> 5.3. </b> "
---

## 5.3.1 What “ingestion” means for AWS Jewelry Web

We keep ingestion lightweight by using the existing Lightsail API and CloudWatch structured logs, instead of a separate clickstream pipeline.

- React frontend emits key product events: `page_view`, `product_view`, `add_to_cart`, `checkout_start`, `checkout_complete`.
- Events are POSTed to the **Lightsail API**, which validates and logs them as JSON to **CloudWatch Logs**.
- Product images upload through **presigned URLs** generated by the API; CloudFront reads images from the private S3 bucket.

This meets observability needs while staying within the project’s cost/scope constraints.

---

## 5.3.2 Event/Log schema (suggested)

- Identity: `userId` (if logged in), `clientId`, `sessionId`, `userLoginState`, `identitySource`.
- Event: `eventName`, `eventTimestamp`.
- Product context: `productId`, `name`, `category`, `brand`, `price`, `discountPrice`, `urlPath`.
- Request/meta: `path`, `method`, `statusCode`, `latencyMs`, `userAgent`, `sourceIp`, `requestId`.

Store as structured JSON in CloudWatch for later export/query.

---

## 5.3.3 API responsibilities

- `/events`: accept validated event payloads; reject unknown types.
- Presigned uploads: issue PUT URLs with content-type and key constraints.
- Secrets: fetch `DB_PASSWORD` and `APP_CONFIG` (bucket name) from **Secrets Manager**; no hardcoded secrets.
- Logging: write structured CloudWatch entries for auth success/fail, CRUD, uploads, and business events.

---

## 5.3.4 Frontend wiring

- Use Cognito JWT for authenticated calls; treat guests with generated `clientId` + `sessionId`.
- Persist `clientId` (localStorage) and `sessionId` (sessionStorage) with idle timeout.
- Non-blocking fire-and-forget POST per event; retries are optional but should not block UI.
- Image upload flow: request presigned URL → PUT file to S3 → send metadata/key back to API.

---

## 5.3.5 Validation checklist

1. Trigger events (browse, view product, add to cart, start/complete checkout).  
2. Confirm API returns 2xx; verify S3 uploads succeed via presigned URL.  
3. In CloudWatch Logs, verify structured events with identity/product fields.  
4. Confirm Secrets Manager reads (no hardcoded DB creds/bucket).  
5. Verify CORS + HTTPS end to end; ensure CloudFront can read the image bucket, uploads are private.